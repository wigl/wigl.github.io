---
layout: post
title:  "Jenkins持续集成iOS项目"
date:   2016-05-10 00:00:00
categories: App
excerpt: 
---

* content
{:toc}


#### fastlane - gym 命令

````
export LC_ALL="en_US.UTF-8"
export PATH="$PATH:/usr/local/opt/coreutils/libexec/gnubin:/usr/local/bin:/usr/local/bin:/opt/X11/bin:/usr/local/sbin$:/usr/local/share/npm/bin:/opt/codereview/phabricator/bin:/opt/codereview/arcanist/bin"

# 项目名字
projectName="name"

# 计时
SECONDS=0

# 当前时间
now=$(date +"%Y_%m_%d_%H_%M_%S")

# 指定项目的scheme名称
scheme="${projectName}"

# 指定要打包的配置名 Release Debug
configuration="Release"

# 指定打包所使用的输出方式，目前支持app-store, package, ad-hoc, enterprise, development, 和developer-id，即xcodebuild的method参数
export_method='ad-hoc'

# 工程路径
path=${WORKSPACE}/${projectName}.xcworkspace

# 指定项目地址
workspace_path="${path}"

# 指定输出路径
output_path="${HOME}/Pictures/${JOB_NAME}/${projectName}_${now}"

# 创建文件夹
mkdir output_path

# 指定输出归档文件地址
archive_path="${output_path}/${projectName}_${now}.xcarchive"

# 指定输出ipa名称
ipa_name="${projectName}_${now}.ipa"

# 指定输出ipa地址
ipa_path="${output_path}/${ipa_name}"

# pod
pod install

# 先清空前一次build
gym --workspace ${workspace_path} --scheme ${scheme} --clean --configuration ${configuration} --archive_path ${archive_path} --export_method ${export_method} --output_directory ${output_path} --output_name ${ipa_name}

# 输出总用时
echo "===Finished. Total time: ${SECONDS}s==="

````

#### xcodebuild + xcrun命令
````
# 工程名
APP_NAME="YourProjectName"
# 证书
CODE_SIGN_DISTRIBUTION="iPhone Distribution: Shanghai ******* Co., Ltd."
# info.plist路径
project_infoplist_path="./${APP_NAME}/Info.plist"

#取版本号
bundleShortVersion=$(/usr/libexec/PlistBuddy -c "print CFBundleShortVersionString" "${project_infoplist_path}")

#取build值
bundleVersion=$(/usr/libexec/PlistBuddy -c "print CFBundleVersion" "${project_infoplist_path}")

DATE="$(date +%Y%m%d)"
IPANAME="${APP_NAME}_V${bundleShortVersion}_${DATE}.ipa"

#要上传的ipa文件路径
IPA_PATH="$HOME/${IPANAME}"
echo ${IPA_PATH}
echo "${IPA_PATH}">> text.txt

//下面2行是没有Cocopods的用法
echo "=================clean================="
xcodebuild -target "${APP_NAME}"  -configuration 'Release' clean

echo "+++++++++++++++++build+++++++++++++++++"
xcodebuild -target "${APP_NAME}" -sdk iphoneos -configuration 'Release' CODE_SIGN_IDENTITY="${CODE_SIGN_DISTRIBUTION}" SYMROOT='$(PWD)'

//下面2行是集成有Cocopods的用法
echo "=================clean================="
xcodebuild -workspace "${APP_NAME}.xcworkspace" -scheme "${APP_NAME}"  -configuration 'Release' clean

echo "+++++++++++++++++build+++++++++++++++++"
xcodebuild -workspace "${APP_NAME}.xcworkspace" -scheme "${APP_NAME}" -sdk iphoneos -configuration 'Release' CODE_SIGN_IDENTITY="${CODE_SIGN_DISTRIBUTION}" SYMROOT='$(PWD)'

xcrun -sdk iphoneos PackageApplication "./Release-iphoneos/${APP_NAME}.app" -o ~/"${IPANAME}"
````

